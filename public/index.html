<html>
<head>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

<form id="qrForm">
  <label>
    Name:<br>
    <input type="text" name="name" required />
  </label><br>
  
  <label>
    URL:<br>
    <input type="url" name="target_url" required />
  </label><br>
  
  <label>
    DPI:<br>
    <select name="dpi" required>
      <option value="72">Digital</option>
      <option value="300">Print</option>
    </select>
  </label><br/>

  <button type="submit">Create QR Code</button>
</form>

<!-- Preview and Save -->
<div id="qrPreview" style="margin-top:20px; display:none;">
  <h3>Preview:</h3>
  <img id="qrImage" src="" alt="QR Code" style="max-width:300px;" />
  <br>
  <a id="downloadBtn" download="qr-code.png" style="display:none; margin-top:10px; background:#000; color:#fff; padding:10px; text-decoration:none;">Download QR Code</a>
</div>
  
<div id="message"></div>

<script>
  // Initialize Supabase client
  const supabaseUrl = 'https://jdtkyapuzowluikcwixg.supabase.co';
  const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpkdGt5YXB1em93bHVpa2N3aXhnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA5OTkxMzMsImV4cCI6MjA2NjU3NTEzM30.ZCb4XlRZvVUv2VbtOB-xDFk3gTSFGaQLAMCt5VVs1JA';
  const supabase = supabase.createClient(supabaseUrl, supabaseAnonKey);

  const form = document.getElementById('qrForm');
  const qrPreview = document.getElementById('qrPreview');
  const qrImage = document.getElementById('qrImage');
  const downloadBtn = document.getElementById('downloadBtn');
  const messageDiv = document.getElementById('message');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    messageDiv.textContent = '';

    const name = form.name.value.trim();
    const target_url = form.target_url.value.trim();
    const dpi = form.dpi.value;

    // Insert into Supabase
    const { data, error } = await supabase
      .from('qr_codes')
      .insert([{ name, target_url, dpi }]);

    if (error) {
      messageDiv.style.color = 'red';
      messageDiv.textContent = 'Error creating QR code: ' + error.message;
      return;
    }

    messageDiv.style.color = 'green';
    messageDiv.textContent = 'QR code created successfully!';

    // Reset form
    form.reset();

    // Generate QR code URL (your Vercel API endpoint)
    const qrUrl = `/api/qr?code=${encodeURIComponent(target_url)}&dpi=${dpi}&bgcolor=ffffff`;

    // Show preview and download button
    qrImage.src = qrUrl;
    downloadBtn.href = qrUrl;
    qrPreview.style.display = 'block';
    downloadBtn.style.display = 'inline-block';
  });
</script>

</body>
</html>
